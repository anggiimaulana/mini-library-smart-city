        // Data for pillars
        const pillarsData = [{
                id: 'governance',
                title: 'Smart Governance',
                icon: 'üèõÔ∏è',
                description: 'Tata kelola pemerintahan yang transparan, akuntabel, dan partisipatif melalui pemanfaatan teknologi digital.',
                challenges: 'Birokrasi yang lambat, kurangnya transparansi, partisipasi masyarakat rendah, dan sistem yang belum terintegrasi.',
                solutions: 'Implementasi e-government, sistem informasi terintegrasi, platform partisipasi digital, dan open data government.',
                examples: 'Sistem OSS (Online Single Submission), Jakarta Smart City Portal, Aplikasi Qlue untuk laporan masyarakat.',
                technologies: 'Cloud Computing, Big Data Analytics, Mobile Applications, Web Services, Blockchain untuk transparansi.',
                references: [{
                        title: 'Digital Government: Technology and Public Sector Performance',
                        author: 'Margetts & Naumann',
                        year: '2017',
                        type: 'Buku',
                        url: 'https://example.com/ref1'
                    },
                    {
                        title: 'E-Government Success Around the World: Cases, Empirical Studies, and Practical Recommendations',
                        author: 'Garson, G. David',
                        year: '2006',
                        type: 'Jurnal',
                        url: 'https://example.com/ref2'
                    }
                ]
            },
            {
                id: 'branding',
                title: 'Smart Branding',
                icon: 'üåü',
                description: 'Strategi membangun citra dan identitas kota yang kuat melalui teknologi digital untuk menarik investasi dan wisatawan.',
                challenges: 'Kompetisi antar kota, kurangnya identitas unik, promosi yang tidak terintegrasi, dan keterbatasan platform digital.',
                solutions: 'Pengembangan platform digital marketing, content strategy yang konsisten, dan integrasi media sosial untuk promosi kota.',
                examples: 'Visit Jakarta campaign, Wonderful Indonesia digital platform, Smart City Bandung branding strategy.',
                technologies: 'Digital Marketing Platforms, Social Media Management, Content Management Systems, Data Analytics, AR/VR untuk tourism.',
                references: [{
                        title: 'City Branding: Theory and Cases',
                        author: 'Kavaratzis & Hatch',
                        year: '2013',
                        type: 'Buku',
                        url: 'https://example.com/ref3'
                    },
                    {
                        title: 'Smart Tourism Destinations: Ecosystems for Tourism Destination Competitiveness',
                        author: 'Gretzel et al.',
                        year: '2015',
                        type: 'Artikel',
                        url: 'https://example.com/ref4'
                    }
                ]
            },
            {
                id: 'economy',
                title: 'Smart Economy',
                icon: 'üíº',
                description: 'Pengembangan ekonomi kota yang inovatif dan berkelanjutan melalui digitalisasi dan teknologi modern.',
                challenges: 'UMKM belum digital, akses pembiayaan terbatas, skill gap teknologi, dan ekosistem startup yang belum mature.',
                solutions: 'Program digitalisasi UMKM, fintech untuk akses modal, pelatihan digital skills, dan pengembangan startup incubator.',
                examples: 'Program Bangga Buatan Indonesia, Go-Pay untuk UMKM, Tokopedia Seller Center, program 1000 Startup Digital.',
                technologies: 'E-commerce Platforms, Fintech, Digital Payment, Blockchain, AI untuk business analytics, Cloud Computing.',
                references: [{
                        title: 'The Smart Economy in Smart Cities',
                        author: 'Komninos & Mora',
                        year: '2018',
                        type: 'Laporan',
                        url: 'https://example.com/ref5'
                    },
                    {
                        title: 'Digital Transformation and Smart Cities',
                        author: 'OECD Report',
                        year: '2020',
                        type: 'Laporan',
                        url: 'https://example.com/ref6'
                    }
                ]
            },
            {
                id: 'living',
                title: 'Smart Living',
                icon: 'üè†',
                description: 'Peningkatan kualitas hidup masyarakat melalui layanan publik yang cerdas, efisien, dan mudah diakses.',
                challenges: 'Layanan kesehatan dan pendidikan belum merata, transportasi macet, perumahan tidak layak, dan polusi udara tinggi.',
                solutions: 'Telemedicine, e-learning platforms, smart transportation systems, green building development, dan air quality monitoring.',
                examples: 'Aplikasi Alodokter, Ruangguru platform, TransJakarta integration, program Sejuta Rumah, Jakarta Air Quality monitoring.',
                technologies: 'IoT Sensors, Mobile Health Apps, E-learning Platforms, Smart Home Systems, Environmental Monitoring Systems.',
                references: [{
                        title: 'Smart Cities and Quality of Life',
                        author: 'Winters & Cao',
                        year: '2019',
                        type: 'Jurnal',
                        url: 'https://example.com/ref7'
                    },
                    {
                        title: 'Urban Living Labs for Smart Cities',
                        author: 'European Commission',
                        year: '2017',
                        type: 'Laporan',
                        url: 'https://example.com/ref8'
                    }
                ]
            },
            {
                id: 'society',
                title: 'Smart Society',
                icon: 'üë•',
                description: 'Pemberdayaan masyarakat melalui teknologi untuk meningkatkan partisipasi, kolaborasi, dan kohesi sosial.',
                challenges: 'Digital divide, literasi digital rendah, partisipasi masyarakat kurang, dan koordinasi antar komunitas terbatas.',
                solutions: 'Program literasi digital, platform participatory budgeting, community engagement apps, dan social innovation labs.',
                examples: 'Program Digital Talent Scholarship, Musrenbang online, aplikasi Lapor Pak Anies, komunitas digital Indonesia.',
                technologies: 'Social Media Platforms, Collaborative Tools, Mobile Apps for civic engagement, Online Learning Platforms, Digital Literacy Tools.',
                references: [{
                        title: 'Digital Society and Smart Cities',
                        author: 'Castells & Himanen',
                        year: '2014',
                        type: 'Buku',
                        url: 'https://example.com/ref9'
                    },
                    {
                        title: 'Citizen Participation in Smart Cities',
                        author: 'UN-Habitat Report',
                        year: '2020',
                        type: 'Laporan',
                        url: 'https://example.com/ref10'
                    }
                ]
            },
            {
                id: 'environment',
                title: 'Smart Environment',
                icon: 'üå±',
                description: 'Pengelolaan lingkungan yang berkelanjutan melalui teknologi untuk monitoring, konservasi, dan mitigasi dampak lingkungan.',
                challenges: 'Polusi udara dan air tinggi, pengelolaan sampah tidak optimal, deforestasi, dan perubahan iklim yang berdampak pada kota.',
                solutions: 'Smart waste management systems, air quality monitoring networks, renewable energy integration, dan green infrastructure development.',
                examples: 'Jakarta Air Quality monitoring system, Smart waste management di Surabaya, Solar panel integration, Urban farming programs.',
                technologies: 'IoT Environmental Sensors, GIS Mapping, Renewable Energy Systems, Smart Grid, Environmental Management Software.',
                references: [{
                        title: 'Smart Environmental Monitoring Systems',
                        author: 'Kumar & Singh',
                        year: '2021',
                        type: 'Jurnal',
                        url: 'https://example.com/ref11'
                    },
                    {
                        title: 'Sustainable Smart Cities: Environmental Management',
                        author: 'World Bank Group',
                        year: '2019',
                        type: 'Laporan',
                        url: 'https://example.com/ref12'
                    }
                ]
            }
        ];

        // User data
        let currentUser = null;
        let readReferences = new Set();

        // Generate unique code
        function generateUniqueCode() {
            const prefix = 'SCL';
            const number = Math.floor(Math.random() * 999999).toString().padStart(6, '0');
            return `${prefix}-${number}`;
        }

        // Show different pages
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        function showRegister() {
            showPage('registerPage');
        }

        function showLogin() {
            showPage('loginPage');
        }

        function showHome() {
            showPage('homePage');
            renderPillars();
            updateProgress();
        }

        // Registration
        function register() {
            const namaLengkap = document.getElementById('namaLengkap').value;
            const nim = document.getElementById('nim').value;
            const jurusan = document.getElementById('jurusan').value;
            const programStudi = document.getElementById('programStudi').value;

            if (!namaLengkap || !nim || !jurusan || !programStudi) {
                alert('Semua field harus diisi!');
                return;
            }

            const uniqueCode = generateUniqueCode();

            // Store user data
            const userData = {
                namaLengkap,
                nim,
                jurusan,
                programStudi,
                uniqueCode,
                registrationDate: new Date().toISOString()
            };

            // In a real app, this would be sent to a server
            localStorage.setItem('userData_' + uniqueCode, JSON.stringify(userData));

            document.getElementById('uniqueCode').textContent = uniqueCode;
            showPage('successPage');
        }

        // Login
        function login() {
            const kodeUnik = document.getElementById('kodeUnik').value.trim().toUpperCase();

            if (!kodeUnik) {
                alert('Kode unik harus diisi!');
                return;
            }

            // Check if user exists
            const userData = localStorage.getItem('userData_' + kodeUnik);
            if (userData) {
                currentUser = JSON.parse(userData);
                currentUser.uniqueCode = kodeUnik;

                // Load user's reading progress
                const progress = localStorage.getItem('progress_' + kodeUnik);
                if (progress) {
                    readReferences = new Set(JSON.parse(progress));
                }

                showHome();
            } else {
                alert('Kode unik tidak valid! Pastikan Anda sudah mendaftar.');
            }
        }

        // Render pillars
        function renderPillars() {
            const container = document.getElementById('pillarsContainer');
            let totalRefs = 0;

            container.innerHTML = pillarsData.map(pillar => {
                totalRefs += pillar.references.length;

                return `
                    <div class="pillar-card">
                        <div class="pillar-header">
                            <div class="pillar-icon">${pillar.icon}</div>
                            <div class="pillar-title">${pillar.title}</div>
                        </div>
                        <div class="pillar-content">
                            <div class="pillar-image">${pillar.icon}</div>
                            
                            <div class="section">
                                <h4><i class="fas fa-info-circle"></i> Deskripsi</h4>
                                <p>${pillar.description}</p>
                            </div>

                            <div class="section">
                                <h4><i class="fas fa-exclamation-triangle"></i> Tantangan</h4>
                                <p>${pillar.challenges}</p>
                            </div>

                            <div class="section">
                                <h4><i class="fas fa-lightbulb"></i> Solusi</h4>
                                <p>${pillar.solutions}</p>
                            </div>

                            <div class="section">
                                <h4><i class="fas fa-star"></i> Contoh Implementasi</h4>
                                <p>${pillar.examples}</p>
                            </div>

                            <div class="section">
                                <h4><i class="fas fa-cogs"></i> Teknologi</h4>
                                <p>${pillar.technologies}</p>
                            </div>

                            <div class="section">
                                <h4><i class="fas fa-book"></i> Referensi</h4>
                                <div class="references">
                                    ${pillar.references.map((ref, index) => {
                                        const refId = `${pillar.id}_${index}`;
                                        const isRead = readReferences.has(refId);
                                        
                                        return `
                                                                        <div class="reference-item">
                                                                            <div class="reference-info">
                                                                                <div class="reference-title">${ref.title}</div>
                                                                                <div class="reference-meta">
                                                                                    ${ref.author} (${ref.year}) - ${ref.type}
                                                                                    ${isRead ? '<i class="fas fa-check-circle" style="color: var(--success); margin-left: 0.5rem;"></i>' : ''}
                                                                                </div>
                                                                            </div>
                                                                            <div class="reference-actions">
                                                                                <button class="btn btn-sm btn-primary" onclick="viewReference('${ref.url}')">
                                                                                    <i class="fas fa-external-link-alt"></i> Lihat
                                                                                </button>
                                                                                <button class="btn btn-sm ${isRead ? 'btn-success' : 'btn-warning'}" 
                                                                                        onclick="toggleRead('${refId}', this)">
                                                                                    <i class="fas ${isRead ? 'fa-check' : 'fa-bookmark'}"></i> 
                                                                                    ${isRead ? 'Dibaca' : 'Tandai'}
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                    `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('totalReferences').textContent = totalRefs;
        }

        // View reference
        function viewReference(url) {
            // In a real app, this might open a modal or redirect
            window.open(url, '_blank');
        }

        // Toggle read status
        function toggleRead(refId, button) {
            if (readReferences.has(refId)) {
                readReferences.delete(refId);
                button.className = 'btn btn-sm btn-warning';
                button.innerHTML = '<i class="fas fa-bookmark"></i> Tandai';
            } else {
                readReferences.add(refId);
                button.className = 'btn btn-sm btn-success';
                button.innerHTML = '<i class="fas fa-check"></i> Dibaca';
            }

            // Save progress
            if (currentUser) {
                localStorage.setItem('progress_' + currentUser.uniqueCode, JSON.stringify([...readReferences]));
            }

            updateProgress();

            // Update the reference item to show check mark
            const referenceItem = button.closest('.reference-item');
            const referenceMeta = referenceItem.querySelector('.reference-meta');
            const existingCheck = referenceMeta.querySelector('.fa-check-circle');

            if (readReferences.has(refId) && !existingCheck) {
                referenceMeta.innerHTML +=
                    ' <i class="fas fa-check-circle" style="color: var(--success); margin-left: 0.5rem;"></i>';
            } else if (!readReferences.has(refId) && existingCheck) {
                existingCheck.remove();
            }
        }

        // Update progress
        function updateProgress() {
            const totalRefs = pillarsData.reduce((total, pillar) => total + pillar.references.length, 0);
            const readCount = readReferences.size;
            const percentage = totalRefs > 0 ? Math.round((readCount / totalRefs) * 100) : 0;

            document.getElementById('readCount').textContent = readCount;
            document.getElementById('totalReferences').textContent = totalRefs;
            document.getElementById('progressText').textContent = `${percentage}%`;
            document.getElementById('progressFill').style.width = `${percentage}%`;

            // Show certificate section if 100% complete
            const certificateSection = document.getElementById('certificateSection');
            if (percentage === 100) {
                certificateSection.style.display = 'block';

                // Show congratulations notification (only once)
                if (!localStorage.getItem('congratsShown_' + currentUser.uniqueCode)) {
                    setTimeout(() => {
                        showCongratulations();
                        localStorage.setItem('congratsShown_' + currentUser.uniqueCode, 'true');
                    }, 500);
                }
            } else {
                certificateSection.style.display = 'none';
            }
        }

        // Show congratulations
        function showCongratulations() {
            // Create a temporary celebration overlay
            const celebration = document.createElement('div');
            celebration.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(102, 126, 234, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                animation: fadeIn 0.5s ease-out;
            `;

            celebration.innerHTML = `
                <div style="text-align: center; color: white;">
                    <div style="font-size: 5rem; margin-bottom: 1rem; animation: bounce 1s ease-in-out;">üéâ</div>
                    <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">Selamat!</h2>
                    <p style="font-size: 1.2rem;">Anda telah menyelesaikan 100% pembelajaran!</p>
                    <p style="font-size: 1rem; margin-top: 1rem;">Sertifikat sudah tersedia untuk di-download</p>
                </div>
            `;

            document.body.appendChild(celebration);

            // Remove after 3 seconds
            setTimeout(() => {
                celebration.style.animation = 'fadeOut 0.5s ease-out';
                setTimeout(() => {
                    document.body.removeChild(celebration);
                }, 500);
            }, 3000);
        }

        // Certificate modal functions
        function showCertificateModal() {
            if (!currentUser) return;

            // Update certificate with user data
            document.getElementById('certUserName').textContent = currentUser.namaLengkap;
            document.getElementById('certDate').textContent = new Date().toLocaleDateString('id-ID');

            document.getElementById('certificateModal').classList.add('show');
        }

        function closeCertificateModal() {
            document.getElementById('certificateModal').classList.remove('show');
        }

        // Download certificate as PNG
        function downloadCertificate() {
            const certificate = document.getElementById('certificatePreview');

            // Create canvas
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // Set canvas size (higher resolution for better quality)
            canvas.width = 800;
            canvas.height = 560;

            // Fill background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#f8fafc');
            gradient.addColorStop(1, '#e2e8f0');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add border
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 8;
            ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

            // Add decorative corners
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üèÜ', canvas.width - 60, 80);

            // Add title
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('SERTIFIKAT PENYELESAIAN', canvas.width / 2, 120);

            // Add subtitle
            ctx.fillStyle = '#764ba2';
            ctx.font = '24px Arial';
            ctx.fillText('Smart City Mini Library', canvas.width / 2, 160);

            // Add "Diberikan kepada"
            ctx.fillStyle = '#2d3748';
            ctx.font = '18px Arial';
            ctx.fillText('Diberikan kepada:', canvas.width / 2, 220);

            // Add user name
            ctx.fillStyle = '#2d3748';
            ctx.font = 'bold 28px Arial';
            ctx.fillText(currentUser.namaLengkap, canvas.width / 2, 270);

            // Add line under name
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(200, 280);
            ctx.lineTo(600, 280);
            ctx.stroke();

            // Add description
            ctx.fillStyle = '#2d3748';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Telah berhasil menyelesaikan pembelajaran', canvas.width / 2, 320);
            ctx.font = 'bold 18px Arial';
            ctx.fillText('6 Pilar Smart City Indonesia', canvas.width / 2, 345);
            ctx.font = '16px Arial';
            ctx.fillText('dengan membaca seluruh referensi akademik', canvas.width / 2, 370);

            // Add date
            ctx.textAlign = 'left';
            ctx.font = '14px Arial';
            ctx.fillStyle = '#64748b';
            ctx.fillText('Tanggal:', 60, 480);
            ctx.fillText(new Date().toLocaleDateString('id-ID'), 60, 500);

            // Add signature
            ctx.textAlign = 'right';
            ctx.fillText('Smart City Library', canvas.width - 60, 480);
            ctx.fillText('Digital Certificate', canvas.width - 60, 500);

            // Add NIM and Program
            ctx.textAlign = 'center';
            ctx.font = '12px Arial';
            ctx.fillText(`NIM: ${currentUser.nim} | ${currentUser.jurusan} - ${currentUser.programStudi}`, canvas.width / 2,
                520);

            // Download
            const link = document.createElement('a');
            link.download = `Sertifikat_Smart_City_${currentUser.namaLengkap.replace(/\s/g, '_')}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Download certificate as PDF (simplified version)
        function downloadCertificatePDF() {
            // Create a simple HTML content for PDF
            const pdfContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: Arial, sans-serif; margin: 0; padding: 40px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); }
                        .certificate { 
                            max-width: 800px; 
                            margin: 0 auto; 
                            padding: 60px; 
                            border: 8px solid #667eea; 
                            background: white;
                            text-align: center;
                            position: relative;
                        }
                        .decoration { position: absolute; top: 20px; right: 30px; font-size: 40px; opacity: 0.2; }
                        .title { color: #667eea; font-size: 36px; font-weight: bold; margin-bottom: 10px; }
                        .subtitle { color: #764ba2; font-size: 24px; margin-bottom: 40px; }
                        .recipient { color: #2d3748; font-size: 18px; margin: 20px 0 10px; }
                        .name { color: #2d3748; font-size: 28px; font-weight: bold; margin: 10px 0; border-bottom: 3px solid #667eea; display: inline-block; padding: 5px 20px; }
                        .description { color: #2d3748; font-size: 16px; margin: 30px 0; line-height: 1.6; }
                        .footer { display: flex; justify-content: space-between; margin-top: 60px; font-size: 14px; color: #64748b; }
                        .meta { font-size: 12px; color: #64748b; margin-top: 30px; }
                    </style>
                </head>
                <body>
                    <div class="certificate">
                        <div class="decoration">üèÜ</div>
                        <div class="title">SERTIFIKAT PENYELESAIAN</div>
                        <div class="subtitle">Smart City Mini Library</div>
                        <div class="recipient">Diberikan kepada:</div>
                        <div class="name">${currentUser.namaLengkap}</div>
                        <div class="description">
                            Telah berhasil menyelesaikan pembelajaran<br>
                            <strong>6 Pilar Smart City Indonesia</strong><br>
                            dengan membaca seluruh referensi akademik
                        </div>
                        <div class="footer">
                            <div>
                                <div>Tanggal:</div>
                                <div>${new Date().toLocaleDateString('id-ID')}</div>
                            </div>
                            <div>
                                <div>Smart City Library</div>
                                <div>Digital Certificate</div>
                            </div>
                        </div>
                        <div class="meta">
                            NIM: ${currentUser.nim} | ${currentUser.jurusan} - ${currentUser.programStudi}
                        </div>
                    </div>
                </body>
                </html>
            `;

            // Open in new window for printing/saving as PDF
            const newWindow = window.open('', '_blank');
            newWindow.document.write(pdfContent);
            newWindow.document.close();

            // Trigger print dialog
            setTimeout(() => {
                newWindow.print();
            }, 500);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('certificateModal');
            if (e.target === modal) {
                closeCertificateModal();
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const urlParams = new URLSearchParams(window.location.search);
            const savedCode = urlParams.get('code') || localStorage.getItem('currentUser');

            if (savedCode) {
                const userData = localStorage.getItem('userData_' + savedCode);
                if (userData) {
                    currentUser = JSON.parse(userData);
                    currentUser.uniqueCode = savedCode;

                    const progress = localStorage.getItem('progress_' + savedCode);
                    if (progress) {
                        readReferences = new Set(JSON.parse(progress));
                    }

                    showHome();
                    return;
                }
            }

            // Default to register page
            showPage('registerPage');
        });

        // Add some demo data for testing
        if (!localStorage.getItem('userData_SCL-123456')) {
            const demoUser = {
                namaLengkap: 'Demo User',
                nim: '123456789',
                jurusan: 'Teknik Informatika',
                programStudi: 'S1',
                uniqueCode: 'SCL-123456',
                registrationDate: new Date().toISOString()
            };
            localStorage.setItem('userData_SCL-123456', JSON.stringify(demoUser));
        }